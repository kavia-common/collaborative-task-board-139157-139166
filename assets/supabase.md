# Supabase Configuration for Collaborative Task Board

This document describes the Supabase backend setup for the Taskboard frontend, including schema, Realtime, Row Level Security (RLS) policies, and integration notes.

Last updated: [auto-generated by Supabase Configuration Agent]

## Environment Variables (Frontend)

The React app expects these environment variables at runtime:
- REACT_APP_SUPABASE_URL
- REACT_APP_SUPABASE_KEY

Create or update your `.env` in `collaborative-task-board-139157-139166/taskboard_frontend/`:

REACT_APP_SUPABASE_URL=YOUR_SUPABASE_URL
REACT_APP_SUPABASE_KEY=YOUR_SUPABASE_ANON_KEY

Note: The current container has these variables defined: REACT_APP_SUPABASE_URL, REACT_APP_SUPABASE_KEY

## Database Schema

Three tables are required and have been created:

1) public.boards
- id uuid primary key default gen_random_uuid()
- name text not null
- created_at timestamptz not null default now()

2) public.tasks
- id uuid primary key default gen_random_uuid()
- board_id uuid not null references public.boards(id) on delete cascade
- title text not null
- description text
- status text not null default 'todo'
- priority text not null default 'medium'
- position int4 default 0
- created_at timestamptz not null default now()
- updated_at timestamptz not null default now()
Indexes:
- idx_tasks_board_status_position on (board_id, status, position)

3) public.activity
- id uuid primary key default gen_random_uuid()
- board_id uuid not null references public.boards(id) on delete cascade
- message text not null
- metadata jsonb default '{}'::jsonb
- created_at timestamptz not null default now()
Indexes:
- idx_activity_board_created on (board_id, created_at desc)

## Realtime Configuration

The following tables are added to the Realtime publication (supabase_realtime):
- public.boards
- public.tasks
- public.activity

This enables the frontend to subscribe to Postgres changes via Supabase Realtime channels.

## Row Level Security (RLS) and Policies

RLS has been enabled on all three tables. For demo purposes, permissive policies have been created:

Boards
- Boards read: allow select for all (using true)
- Boards insert: allow insert for all (with check true)

Tasks
- Tasks read: allow select for all
- Tasks insert: allow insert for all
- Tasks update: allow update for all

Activity
- Activity read: allow select for all
- Activity insert: allow insert for all

Security note: These policies are intentionally permissive for development and demos. For production, lock these down to authenticated users and ownership-based rules as needed.

## Frontend Integration Notes

- The app uses @supabase/supabase-js v2 and initializes a singleton client from env vars at src/lib/supabaseClient.js.
- Realtime subscriptions:
  - Tasks: channel "postgres_changes" on public.tasks with filter board_id=eq.{boardId}
  - Activity: channel "postgres_changes" on public.activity with filter board_id=eq.{boardId}
- Data loading:
  - Boards and tasks are fetched via REST:
    - boards ordered by created_at
    - tasks filtered by board_id ordered by position
- Mutations:
  - Inserting boards/tasks and updating tasks (status/position) via REST are supported
  - Activity entries inserted on significant events

## Required Allow Lists (Supabase Dashboard)

In Supabase Dashboard:
- Auth > URL Configuration
  - Set Site URL to your dev or prod URL (e.g., http://localhost:3000 in local)
  - Add Redirect URLs if you later implement OAuth or email flows

## Testing and Verification

- Tables exist and are in publication
- RLS enabled and permissive policies created
- Foreign keys and indexes present

You can verify with queries:
- select * from boards;
- select * from tasks where board_id = '<some-board-id>' order by position;
- select * from activity where board_id = '<some-board-id>' order by created_at desc;

## Maintenance

This file is the source of truth for the backend setup. If adding features (comments, labels, attachments, users), extend the schema and update policies accordingly. For production hardening:
- Restrict policies to authenticated users
- Add owner columns (created_by uuid referencing auth.users)
- Separate anon behaviors from authenticated
- Consider triggers to update updated_at automatically on tasks
